class _{constructor(){this.charts={},this.periodSelector=document.querySelector('select[name="period"]'),this.init()}init(){console.log("AnalyticsPage init started");const e=["monthlyTrendsChart","total-sppd","approved-sppd","rejected-sppd","review-sppd","total-change","approved-change","rejected-change","review-change"].filter(a=>!document.getElementById(a));e.length>0?console.error("Missing required elements:",e):console.log("All required elements found"),this.periodSelector&&this.periodSelector.addEventListener("change",a=>{this.fetchAndRender(a.target.value)}),this.initChartTypeSelector(),this.initTimeframeSelector(),this.fetchAndRender(this.periodSelector?this.periodSelector.value:"12"),this.bindChartClicks(),this.bindModalClose(),console.log("AnalyticsPage init completed")}initChartTypeSelector(){const t=document.getElementById("chartTypeSelector");t?(console.log("Chart type selector found, adding event listener"),t.addEventListener("change",e=>{var a;console.log("Chart type changed to:",e.target.value),this.renderMonthlyTrends(((a=this.currentData)==null?void 0:a.monthlyTrends)||[])})):console.error("Chart type selector not found")}initTimeframeSelector(){const t=document.querySelectorAll(".timeframe-btn");t.forEach(e=>{e.addEventListener("click",a=>{t.forEach(o=>{o.classList.remove("active","bg-indigo-600","text-white"),o.classList.add("bg-gray-100","text-gray-700")}),e.classList.add("active","bg-indigo-600","text-white"),e.classList.remove("bg-gray-100","text-gray-700");const n=e.getAttribute("data-period");this.fetchAndRender(n)})})}async fetchAndRender(t){try{const a=await(await fetch(`/analytics/data?period=${t}`)).json();if(a.error)throw new Error(a.error);this.currentData=a,this.renderAll(a);const o=new Date().toLocaleString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),r=document.getElementById("last-updated");r&&(r.innerText=o)}catch(e){this.showError("Gagal memuat data analytics: "+e.message)}}renderAll(t){console.log("renderAll called with data:",t),this.renderMonthlyTrends(t.monthlyTrends),this.renderBudgetTrends(t.monthlyTrends),this.renderStatusDistribution(t.statusDistribution),this.renderDepartmentAnalysis(t.departmentAnalysis),this.renderApprovalPerformance(t.approvalPerformance),this.renderTopDestinations(t.trendingData.top_destinations),this.renderBudgetUtilization(t.overview&&t.overview.budget_utilization?t.overview.budget_utilization:null),this.renderInsights(t),this.updateSummaryCards(t.monthlyTrends)}renderMonthlyTrends(t){console.log("renderMonthlyTrends called with:",t);const e=document.getElementById("monthlyTrendsChart"),a=document.getElementById("volumeChart");if(!e){console.error("monthlyTrendsChart canvas not found");return}const n=(t||[]).map(d=>d.period),o=(t||[]).map(d=>d.sppd_count),r=(t||[]).map(d=>d.approved_count||0),l=(t||[]).map(d=>d.rejected_count||0),s=(t||[]).map(d=>d.in_review_count||0),i=(t||[]).map(d=>d.revision_count||0),c=(t||[]).map(d=>d.total_budget||0),p=(t||[]).map(d=>d.approval_rate||0);console.log("Processed data:",{labels:n,totalSppd:o,approved:r,rejected:l,inReview:s,revision:i});const v=document.getElementById("chartTypeSelector"),u=v?v.value:"sppd_count";console.log("Current chart type:",u);let f=[],y=[];switch(u){case"sppd_count":f=[{label:"Disetujui",data:r,borderColor:"rgb(34, 197, 94)",backgroundColor:"rgba(34, 197, 94, 0.1)",tension:.4,borderWidth:3,pointBackgroundColor:"rgb(34, 197, 94)",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,fill:!1,order:1},{label:"Ditolak",data:l,borderColor:"rgb(239, 68, 68)",backgroundColor:"rgba(239, 68, 68, 0.1)",tension:.4,borderWidth:3,pointBackgroundColor:"rgb(239, 68, 68)",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,fill:!1,order:2},{label:"Dalam Review",data:s,borderColor:"rgb(245, 158, 11)",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.4,borderWidth:3,pointBackgroundColor:"rgb(245, 158, 11)",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,fill:!1,order:3},{label:"Revisi",data:i,borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",tension:.4,borderWidth:3,pointBackgroundColor:"rgb(168, 85, 247)",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,fill:!1,order:4},{label:"Total SPPD",data:o,borderColor:"rgb(59, 130, 246)",backgroundColor:"transparent",tension:.4,borderWidth:2,pointBackgroundColor:"transparent",pointBorderColor:"rgb(59, 130, 246)",pointBorderWidth:2,pointRadius:3,pointHoverRadius:5,fill:!1,order:5}],y=o;break;case"budget":f=[{label:"Total Anggaran (Rp)",data:c,borderColor:"rgb(16, 185, 129)",backgroundColor:"rgba(16, 185, 129, 0.1)",tension:.4,borderWidth:3,pointBackgroundColor:"rgb(16, 185, 129)",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,fill:!1}],y=c;break;case"approval_rate":f=[{label:"Tingkat Approval (%)",data:p,borderColor:"rgb(236, 72, 153)",backgroundColor:"rgba(236, 72, 153, 0.1)",tension:.4,borderWidth:3,pointBackgroundColor:"rgb(236, 72, 153)",pointBorderColor:"#ffffff",pointBorderWidth:2,pointRadius:6,pointHoverRadius:8,fill:!1}],y=o;break}this.charts.monthlyTrends&&(console.log("Destroying existing monthlyTrends chart"),this.charts.monthlyTrends.destroy()),this.charts.volumeChart&&(console.log("Destroying existing volumeChart"),this.charts.volumeChart.destroy()),console.log("Creating new chart with datasets:",f),this.charts.monthlyTrends=new Chart(e,{type:"line",data:{labels:n,datasets:f},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"nearest",axis:"x",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"#ffffff",bodyColor:"#ffffff",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,callbacks:{label:function(d){let b=d.dataset.label||"";return b&&(b+=": "),d.parsed.y!==null&&(u==="budget"?b+="Rp "+d.parsed.y.toLocaleString():u==="approval_rate"?b+=d.parsed.y.toFixed(1)+"%":b+=d.parsed.y+" SPPD"),b}}}},scales:{x:{display:!0,title:{display:!0,text:"Periode"},grid:{display:!1}},y:{display:!0,title:{display:!0,text:u==="budget"?"Anggaran (Rp)":u==="approval_rate"?"Tingkat Approval (%)":"Jumlah SPPD"},grid:{color:"rgba(0, 0, 0, 0.1)"},beginAtZero:!0}},elements:{point:{hoverRadius:8,radius:6},line:{tension:.4}}}}),a&&y.length>0&&(this.charts.volumeChart=new Chart(a,{type:"bar",data:{labels:n,datasets:[{label:u==="budget"?"Volume Anggaran":"Volume SPPD",data:y,backgroundColor:u==="budget"?"rgba(16, 185, 129, 0.3)":"rgba(59, 130, 246, 0.3)",borderColor:u==="budget"?"rgb(16, 185, 129)":"rgb(59, 130, 246)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(d){return u==="budget"?"Volume: Rp "+d.parsed.y.toLocaleString():"Volume: "+d.parsed.y+" SPPD"}}}},scales:{x:{display:!1},y:{display:!1}}}})),this.updateSummaryCards(t),this.updateMonthlyInsight(t)}updateMonthlyInsight(t){if(!t||t.length===0)return;const e=t[t.length-1],a=t.length>1?t[t.length-2]:null;let n="";const o=document.getElementById("chartTypeSelector"),r=o?o.value:"sppd_count";r==="sppd_count"?n=this.generateSppdCountInsight(e,a,t):r==="budget"?n=this.generateBudgetInsight(e,a,t):r==="approval_rate"&&(n=this.generateApprovalRateInsight(e,a,t));const l=document.getElementById("insight-monthly");l&&(l.innerHTML=n)}generateSppdCountInsight(t,e,a){const n=t.sppd_count||0,o=t.approved_count||0,r=t.rejected_count||0,l=t.in_review_count||0,s=t.revision_count||0;let i="ðŸ“Š <strong>Analisis Tren SPPD Bulanan:</strong><br>";if(i+=`â€¢ Total SPPD periode ini: <strong>${n}</strong> SPPD<br>`,i+=`â€¢ Breakdown: Disetujui <strong>${o}</strong>, Ditolak <strong>${r}</strong>, Review <strong>${l}</strong>, Revisi <strong>${s}</strong><br>`,e){const c=((n-e.sppd_count)/e.sppd_count*100).toFixed(1),p=n>0?(o/n*100).toFixed(1):0,v=n>0?(r/n*100).toFixed(1):0;i+=`â€¢ Perubahan dari bulan lalu: <strong>${c}%</strong><br>`,i+=`â€¢ Tingkat approval: <strong>${p}%</strong>, Tingkat rejection: <strong>${v}%</strong><br>`}if(a.length>=3){const c=a.slice(-3),p=c.reduce((u,f)=>u+(f.sppd_count||0),0)/c.length,v=p>n*1.1?"meningkat":p<n*.9?"menurun":"stabil";i+=`â€¢ Tren 3 bulan terakhir: <strong>${v}</strong> (rata-rata ${p.toFixed(1)} SPPD/bulan)`}return i}generateBudgetInsight(t,e,a){const n=t.total_budget||0,o=t.avg_budget_per_sppd||0,r=t.max_budget||0,l=t.min_budget||0;let s="ðŸ’° <strong>Analisis Tren Anggaran Bulanan:</strong><br>";if(s+=`â€¢ Total anggaran periode ini: <strong>Rp ${n.toLocaleString()}</strong><br>`,s+=`â€¢ Rata-rata anggaran per SPPD: <strong>Rp ${o.toLocaleString()}</strong><br>`,s+=`â€¢ Range anggaran: Rp ${l.toLocaleString()} - Rp ${r.toLocaleString()}<br>`,e){const c=((n-e.total_budget)/e.total_budget*100).toFixed(1);s+=`â€¢ Perubahan anggaran dari bulan lalu: <strong>${c}%</strong><br>`}const i=n>0?((t.approved_count||0)/(t.sppd_count||1)*100).toFixed(1):0;return s+=`â€¢ Efisiensi anggaran (approval rate): <strong>${i}%</strong>`,s}generateApprovalRateInsight(t,e,a){const n=t.approval_rate||0,o=t.sppd_count||0,r=t.approved_count||0;let l="âœ… <strong>Analisis Tingkat Approval Bulanan:</strong><br>";if(l+=`â€¢ Tingkat approval periode ini: <strong>${n}%</strong><br>`,l+=`â€¢ Total SPPD: <strong>${o}</strong>, Disetujui: <strong>${r}</strong><br>`,e){const i=(n-e.approval_rate).toFixed(1),c=i>=0?"ðŸ“ˆ":"ðŸ“‰";l+=`â€¢ Perubahan tingkat approval: <strong>${c} ${i}%</strong><br>`}let s="";return n>=80?s="Sangat Baik":n>=60?s="Baik":n>=40?s="Cukup":s="Perlu Perbaikan",l+=`â€¢ Performa approval: <strong>${s}</strong>`,l}renderBudgetTrends(t){const e=document.getElementById("budgetTrendsChart");if(!e)return;const a=(t||[]).map(o=>o.period),n=(t||[]).map(o=>o.total_budget);this.charts.budgetTrends&&this.charts.budgetTrends.destroy(),this.charts.budgetTrends=new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"Anggaran (Rp)",data:n,backgroundColor:"rgba(16, 185, 129, 0.8)",borderColor:"rgb(16, 185, 129)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:function(o){return"Rp "+o.toLocaleString()}}}}}}),a.length||this.showEmpty(e,"Tidak ada data anggaran")}renderStatusDistribution(t){const e=document.getElementById("statusChart");if(!e)return;const a=Object.keys(t||{}),n=Object.values(t||{});this.charts.status&&this.charts.status.destroy(),this.charts.status=new Chart(e,{type:"doughnut",data:{labels:a,datasets:[{data:n,backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(239, 68, 68, 0.8)","rgba(59, 130, 246, 0.8)","rgba(245, 158, 11, 0.8)","rgba(139, 92, 246, 0.8)"],borderWidth:2,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),a.length||this.showEmpty(e,"Tidak ada data status")}renderDepartmentAnalysis(t){const e=document.getElementById("departmentAnalysisChart");if(!e)return;const a=(t||[]).map(r=>r.department),n=(t||[]).map(r=>r.total_requests),o=(t||[]).map(r=>r.approved_count);this.charts.department&&this.charts.department.destroy(),this.charts.department=new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"Total SPPD",data:n,backgroundColor:"rgba(59, 130, 246, 0.4)"},{label:"Disetujui",data:o,backgroundColor:"rgba(34, 197, 94, 0.7)"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0}},scales:{x:{beginAtZero:!0}}}}),a.length||this.showEmpty(e,"Tidak ada data departemen")}renderApprovalPerformance(t){const e=document.getElementById("approvalPerformanceChart");if(!e)return;const a=(t||[]).map(o=>o.approver_name),n=(t||[]).map(o=>o.total_approvals);this.charts.approval&&this.charts.approval.destroy(),this.charts.approval=new Chart(e,{type:"pie",data:{labels:a,datasets:[{data:n,backgroundColor:["rgba(59, 130, 246, 0.7)","rgba(34, 197, 94, 0.7)","rgba(245, 158, 11, 0.7)","rgba(239, 68, 68, 0.7)","rgba(139, 92, 246, 0.7)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}}),a.length||this.showEmpty(e,"Tidak ada data approval")}renderTopDestinations(t){const e=document.getElementById("topDestinationsChart");if(!e)return;const a=(t||[]).map(o=>o.tujuan),n=(t||[]).map(o=>o.count);this.charts.destinations&&this.charts.destinations.destroy(),this.charts.destinations=new Chart(e,{type:"bar",data:{labels:a,datasets:[{label:"Jumlah Kunjungan",data:n,backgroundColor:"rgba(59, 130, 246, 0.4)"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}}),a.length||this.showEmpty(e,"Tidak ada data destinasi")}renderBudgetUtilization(t){const e=document.getElementById("budgetUtilizationChart");if(!e||!t)return;const a=t.used||0,n=t.remaining||0;this.charts.budgetUtilization&&this.charts.budgetUtilization.destroy(),this.charts.budgetUtilization=new Chart(e,{type:"doughnut",data:{labels:["Terpakai","Sisa"],datasets:[{data:[a,n],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(59, 130, 246, 0.8)"],borderWidth:2,borderColor:"#fff"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})}renderInsights(t){const e=t.monthlyTrends||[];let a="Belum ada data SPPD.";if(e.length>1){const g=e[e.length-1],m=e[e.length-2],h=g.sppd_count-m.sppd_count;h>0?a=`Jumlah SPPD bulan ${g.period} meningkat ${h} dibanding bulan sebelumnya.`:h<0?a=`Jumlah SPPD bulan ${g.period} menurun ${Math.abs(h)} dibanding bulan sebelumnya.`:a=`Jumlah SPPD bulan ${g.period} sama dengan bulan sebelumnya.`}else e.length===1&&(a=`Terdapat ${e[0].sppd_count} SPPD pada ${e[0].period}.`);document.getElementById("insight-monthly").innerText=a;function n(g){return"Rp "+Number(g).toLocaleString("id-ID",{minimumFractionDigits:2,maximumFractionDigits:2})}let o="Belum ada data anggaran.";if(e.length>1){const g=e[e.length-1],m=e[e.length-2],h=g.total_budget-m.total_budget;h>0?o=`Total anggaran bulan ${g.period} naik ${n(h)} dibanding bulan sebelumnya.`:h<0?o=`Total anggaran bulan ${g.period} turun ${n(Math.abs(h))} dibanding bulan sebelumnya.`:o=`Total anggaran bulan ${g.period} sama dengan bulan sebelumnya.`}else e.length===1&&(o=`Total anggaran bulan ${e[0].period}: ${n(e[0].total_budget)}.`);document.getElementById("insight-budget").innerText=o;const r=t.statusDistribution||{};let l=null,s=0,i=0;Object.entries(r).forEach(([g,m])=>{m>s&&(s=m,l=g),i+=m});let c="Belum ada data status.";l&&(c=`Status SPPD terbanyak adalah "${l}" (${s} dari ${i} SPPD).`),document.getElementById("insight-status").innerText=c;const p=t.departmentAnalysis||[];let v="Belum ada data departemen.";if(p.length>0){const g=p.reduce((m,h)=>m.total_requests>h.total_requests?m:h);v=`Departemen dengan SPPD terbanyak: ${g.department} (${g.total_requests} SPPD).`}document.getElementById("insight-department").innerText=v;const u=t.approvalPerformance||[];let f="Belum ada data approval.";if(u.length>0){const g=u.reduce((m,h)=>m.total_approvals>h.total_approvals?m:h);f=`Approval terbanyak oleh ${g.approver_name} (${g.total_approvals} approval).`}document.getElementById("insight-approval").innerText=f;const y=t.trendingData&&t.trendingData.top_destinations?t.trendingData.top_destinations:[];let d="Belum ada data destinasi.";if(y.length>0){const g=y[0];d=`Destinasi paling populer: ${g.tujuan} (${g.count} kali perjalanan).`}document.getElementById("insight-destination").innerText=d;const b=t.overview&&t.overview.budget_utilization?t.overview.budget_utilization:null;let C="Belum ada data utilisasi anggaran.";b&&(C=`Anggaran terpakai: ${n(b.used)} dari total alokasi ${n(b.allocated)} (${b.utilization_rate}% terpakai).`),document.getElementById("insight-utilization").innerText=C}showEmpty(t,e){if(t&&t.parentNode){t.parentNode.querySelectorAll(".empty-chart-msg").forEach(n=>n.remove());const a=document.createElement("div");a.className="empty-chart-msg",a.style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#888;text-align:center;z-index:10;pointer-events:none;",a.innerText=e,t.parentNode.appendChild(a)}}showError(t){alert(t)}bindChartClicks(){const t=document.getElementById("monthlyTrendsChart");t&&(t.onclick=s=>{const i=this.charts.monthlyTrends.getElementsAtEventForMode(s,"nearest",{intersect:!0},!0);if(i.length){const c=i[0].index,p=this.charts.monthlyTrends.data.labels[c];this.showDetailModal("monthly",{period:p})}});const e=document.getElementById("budgetTrendsChart");e&&(e.onclick=s=>{const i=this.charts.budgetTrends.getElementsAtEventForMode(s,"nearest",{intersect:!0},!0);if(i.length){const c=i[0].index,p=this.charts.budgetTrends.data.labels[c];this.showDetailModal("budget",{period:p})}});const a=document.getElementById("statusChart");a&&(a.onclick=s=>{const i=this.charts.status.getElementsAtEventForMode(s,"nearest",{intersect:!0},!0);if(i.length){const c=i[0].index,p=this.charts.status.data.labels[c];this.showDetailModal("status",{status:p})}});const n=document.getElementById("departmentAnalysisChart");n&&(n.onclick=s=>{const i=this.charts.department.getElementsAtEventForMode(s,"nearest",{intersect:!0},!0);if(i.length){const c=i[0].index,p=this.charts.department.data.labels[c];this.showDetailModal("department",{department:p})}});const o=document.getElementById("approvalPerformanceChart");o&&(o.onclick=s=>{const i=this.charts.approval.getElementsAtEventForMode(s,"nearest",{intersect:!0},!0);if(i.length){const c=i[0].index,p=this.charts.approval.data.labels[c];this.showDetailModal("approval",{approver:p})}});const r=document.getElementById("topDestinationsChart");r&&(r.onclick=s=>{const i=this.charts.destinations.getElementsAtEventForMode(s,"nearest",{intersect:!0},!0);if(i.length){const c=i[0].index,p=this.charts.destinations.data.labels[c];this.showDetailModal("destination",{tujuan:p})}});const l=document.getElementById("budgetUtilizationChart");l&&(l.onclick=()=>{this.showDetailModal("utilization",{})})}showDetailModal(t,e){const a=document.getElementById("analytics-modal"),n=document.getElementById("analytics-modal-content");a.classList.remove("hidden"),n.innerHTML="<div class='text-center text-lg font-bold mb-4'>Memuat detail...</div>",n.dataset.detailType=t,n.dataset.detailParams=JSON.stringify(e);const o=new URL("/analytics/detail",window.location.origin);o.searchParams.set("type",t),Object.entries(e).forEach(([r,l])=>o.searchParams.set(r,l)),fetch(o).then(r=>r.json()).then(r=>{let l=`<div class='text-xl font-bold mb-2'>${r.title}</div>`;r.columns&&r.columns.length?(l+="<div class='overflow-x-auto'><table class='min-w-full text-sm border rounded-lg'>",l+=`<thead><tr>${r.columns.map(s=>`<th class='px-3 py-2 bg-slate-100 border-b text-left'>${s}</th>`).join("")}</tr></thead>`,l+="<tbody>",r.data&&r.data.length?r.data.forEach(s=>{l+=`<tr>${s.map(i=>`<td class='px-3 py-2 border-b'>${i}</td>`).join("")}</tr>`}):l+=`<tr><td colspan='${r.columns.length}' class='text-center py-4 text-gray-400'>Tidak ada data.</td></tr>`,l+="</tbody></table></div>"):l+="<div class='text-gray-400 text-center py-8'>Tidak ada data detail.</div>",n.innerHTML=l}).catch(()=>{n.innerHTML="<div class='text-red-500 text-center py-8'>Gagal memuat detail data.</div>"})}bindModalClose(){const t=document.getElementById("analytics-modal"),e=document.getElementById("close-analytics-modal");e&&(e.onclick=()=>{t.classList.add("hidden")}),t.addEventListener("click",a=>{a.target===t&&t.classList.add("hidden")})}updateSummaryCards(t){if(console.log("updateSummaryCards called with:",t),!t||t.length===0){console.log("No monthly trends data available");return}const e=t[t.length-1];if(console.log("Latest data:",e),t.length>=2){const a=t[t.length-2];console.log("Previous data:",a);const n=this.calculateChange(e.sppd_count,a.sppd_count),o=this.calculateChange(e.approved_count,a.approved_count),r=this.calculateChange(e.rejected_count,a.rejected_count),l=this.calculateChange(e.in_review_count,a.in_review_count);console.log("Changes calculated:",{totalChange:n,approvedChange:o,rejectedChange:r,reviewChange:l}),this.updateCard("total-sppd",e.sppd_count,n,"total-change"),this.updateCard("approved-sppd",e.approved_count,o,"approved-change"),this.updateCard("rejected-sppd",e.rejected_count,r,"rejected-change"),this.updateCard("review-sppd",e.in_review_count,l,"review-change")}else console.log("Only one data point available, showing current values with 0% change"),this.updateCard("total-sppd",e.sppd_count,"0%","total-change"),this.updateCard("approved-sppd",e.approved_count,"0%","approved-change"),this.updateCard("rejected-sppd",e.rejected_count,"0%","rejected-change"),this.updateCard("review-sppd",e.in_review_count,"0%","review-change")}calculateChange(t,e){if(e===0)return t>0?"+100%":"0%";const a=(t-e)/e*100;return a>=0?`+${a.toFixed(1)}%`:`${a.toFixed(1)}%`}updateCard(t,e,a,n){console.log(`updateCard called: ${t} = ${e}, ${n} = ${a}`);const o=document.getElementById(t),r=document.getElementById(n);console.log("Card element found:",!!o),console.log("Change element found:",!!r),o?(o.textContent=e||0,console.log(`Updated ${t} to:`,e||0)):console.error(`Card element not found: ${t}`),r?(r.textContent=a,a.startsWith("+")?r.className="text-xs text-green-600":a.startsWith("-")?r.className="text-xs text-red-600":r.className="text-xs text-gray-500",console.log(`Updated ${n} to:`,a)):console.error(`Change element not found: ${n}`)}}document.getElementById("monthlyTrendsChart")&&(window.analyticsPage=new _);
