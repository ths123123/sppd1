var l=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var c=l((u,s)=>{class d{constructor(){this.init()}init(){this.listenForProfileUpdates(),this.listenForStorageEvents(),this.setupMutationObserver()}listenForProfileUpdates(){document.addEventListener("profileUpdated",t=>{t.detail&&t.detail.avatar&&this.updateNavbarPhoto(t.detail.avatar)}),document.addEventListener("profilePhotoChanged",t=>{t.detail&&t.detail.newPhotoUrl&&this.updateNavbarPhoto(t.detail.newPhotoUrl)})}listenForStorageEvents(){window.addEventListener("storage",t=>{if(t.key==="profilePhotoUpdated"&&t.newValue){const e=JSON.parse(t.newValue);this.updateNavbarPhoto(e.url),localStorage.removeItem("profilePhotoUpdated")}})}setupMutationObserver(){const t=new MutationObserver(a=>{a.forEach(r=>{if(r.type==="attributes"&&r.attributeName==="src"&&r.target.id==="profile-photo-preview"){const i=r.target.src;i&&i.startsWith("blob:")&&this.updateNavbarPhoto(i,!0)}})}),e=document.getElementById("profile-photo-preview");e&&t.observe(e,{attributes:!0,attributeFilter:["src"]})}updateNavbarPhoto(t,e=!1){const a=document.getElementById("navbar-profile-photo"),r=document.getElementById("dropdown-profile-photo");if(!a){console.warn("Navbar profile photo element not found");return}if(a.tagName==="IMG")a.src=t,a.style.opacity="0.7",a.addEventListener("load",function(){this.style.opacity="1",this.style.border="3px solid #10b981",this.style.boxShadow="0 0 20px rgba(16, 185, 129, 0.5)",setTimeout(()=>{this.style.border="2px solid white",this.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)"},2e3)},{once:!0});else{const i=a.parentElement,o=document.createElement("img");o.id="navbar-profile-photo",o.src=t,o.alt="Profile",o.className="min-w-[36px] min-h-[36px] max-w-[36px] max-h-[36px] w-full h-full object-cover rounded-full border-2 border-white shadow-md aspect-square",o.style.opacity="0.7",o.addEventListener("load",function(){this.style.opacity="1",this.style.border="3px solid #10b981",this.style.boxShadow="0 0 20px rgba(16, 185, 129, 0.5)",setTimeout(()=>{this.style.border="2px solid white",this.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)"},2e3)},{once:!0}),i.replaceChild(o,a)}if(r)if(r.tagName==="IMG")r.src=t,r.style.opacity="0.7",r.addEventListener("load",function(){this.style.opacity="1"},{once:!0});else{const i=r.parentElement,o=document.createElement("img");o.id="dropdown-profile-photo",o.src=t,o.alt="Profile",o.className="w-full h-full object-cover rounded-full",o.style.opacity="0.7",o.addEventListener("load",function(){this.style.opacity="1"},{once:!0}),i.replaceChild(o,r)}e||localStorage.setItem("profilePhotoUpdated",JSON.stringify({url:t,timestamp:Date.now()})),document.dispatchEvent(new CustomEvent("navbarPhotoUpdated",{detail:{photoUrl:t}}))}updateNavbarName(t){const e=document.getElementById("dropdown-profile-name");e&&(e.textContent=t,e.style.color="#10b981",setTimeout(()=>{e.style.color=""},2e3))}updateNavbarEmail(t){const e=document.getElementById("dropdown-profile-email");e&&(e.textContent=t,e.style.color="#10b981",setTimeout(()=>{e.style.color=""},2e3))}updateDropdownPhoto(t){document.querySelectorAll('[class*="dropdown"] img[alt*="'+this.getCurrentUserName()+'"]').forEach(a=>{a.src=t,a.style.opacity="0.7",a.addEventListener("load",function(){this.style.opacity="1"},{once:!0})})}getCurrentUserName(){const t=document.querySelector("[data-user-name]");if(t)return t.dataset.userName;const e=document.querySelector(".text-lg.font-bold");return e?e.textContent.trim():"User"}handleProfileUpdateResponse(t){if(t.success&&t.user&&t.user.avatar){const e=t.user.avatar.startsWith("storage/")?`/storage/${t.user.avatar.replace("storage/","")}`:`/storage/${t.user.avatar}`;this.updateNavbarPhoto(e)}}triggerUpdate(t){this.updateNavbarPhoto(t)}}document.addEventListener("DOMContentLoaded",function(){window.navbarProfileUpdater=new d});typeof s<"u"&&s.exports&&(s.exports=d)});export default c();
